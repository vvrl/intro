# Детектор заставки на видео

## 1. Выбор решения

Видео состоит из статичных изображений - кадров, поэтому в любом случае необходимо использовать сверточные нейроннные сети.

Поиск заставки на видео относится к задаче поиска событий. Для решения такого рода задач необходимо не только проанализировать кадр как изображение, но и изучить видео по временным признакам.

Возможные решения:

1. **3D-CNN.** 

3D сверточные сети являются современным решением для обработки трехмерных данных или видео. 
Преимуществом является высокая точность и улучшенная обобщаемость. 
Но они требуют большое количество вычислительных ресурсов и большой объем данных. Из-за этого скорость обучения падает, а потребление памяти растет. 
Также они склонны к переобучению из-за глубины и сложности.

Они обрабатывают сразу несколько кадров, что позволяет сети одноврменно улавливать пространственные признаки и врменные признаки.

2. **CNN + RNN.**

Под RNN имеется ввиду не конкретно рекурентные сети, а что-то что может анализировать последовательности. Это может быть RNN, LSTM или Трансформеры с механизмом внимания. 

Этот подход имеет несколько преимуществ перед 3D СNN. Первое это возможность менять части модели в зависимости от имеющихся ресурсов и требуемой точности: мы можем взять любую CNN модель с предобученными весами и тогда нам не придется долго обучать модель. Соответственно это не так требовательно к ресурсам из-за чего скорость обучния увеличивается.

Второе это отсутствие необходимости в огромном количестве данных. Так как модель не такая сложная, то и данных ей нужно меньше.

### Итог

Второй подход (CNN + RNN) был выбран в этой работе для создания решения для поиска заставок в видео. 

В качестве Сверточной сети была выбрана ResNet50 с предобученными весами на датасете ImageNet. Эта модель была выбрана из-за ее архитектуры, которая решает проблему исчезающего градиента, и из-за относительной простоты, по сравнению с некоторыми другими моделями.

Для анализа временных признаков была выбрана LSTM. Она идеально подходит для этой задачи, так как умеет анализировать последовательности и запоминать важную информацию на длинных промежутках.

## 2. Ход работы

Основными трудностями при разработке этого решения стало создание коротких клипов клипов по 10 секунд с размеченными кадрами как *intro* и *not_intro*.

Для этого был создан класс IntroClipDataset, который является наследником класса Dataset от PyTorch. 

Создание и сохранение подобных клипов с кадрами из видео требует большого количества памяти: или на диске, если мы сохранеям их, чтобы потом загружать в модель, или оперативной если мы пытаемся обойтись без их сохранения. Поэтому основной идеей является создание клипов прямо во время обучения с помощью метода __getitem__. При подготовке данных для каждого клипа размечается начало и конец клипа в секундах, путь к полному видео, начало и конец заставки из полного видео. Затем при получении клипов в __getitem__ функция открывает нужное видео и берет необходимые кадры, сразу же их размечая. Минусом является огромное количество открытий и закрытий видео, но за то решается проблема с загрузкой оперативной памяти.

Все части модели (CNN ResNet50, LSTM и полносвзяный слой) были взяты из PyTorch. Видео открывались и считывались покадрово с помошью OpenCV. 

При обучении возникла проблема, что некоторые видео были повреждены или почему-то не открывались до конца: например на середине видео могло оборваться с ошибкой от видеоплеера.


![alt text](https://i.postimg.cc/4xGfwCGJ/image.png)

## 3. Возможные улучшения

В дальнейшем, чтобы улучшить модель, можно добавить следующие элементы:

1. **Добавить обработку звука**

Огромное количество сериалов имеют в заставке музыку или какие-то фразы. Их анализ совместно с обработкой кадров могут значительно увеличить точность.

2. **Добавить OCR обработчики**

В заставках среиалов обычно показываются одни и те же элементы, например, показываются имена режисера, актеров и т.д., поэтому эти текстовые паттерны могут быть дополнительно обработаны с помощью OCR обработчиков.

3. **Использование более глубоких моделей (при наличии вычислительных ресурсов)**

Более сложные модели могут находить мельчайшие признаки на изображениях, которые недосягаемы простым моделям. Поэтому их использование может повысить всей модели обобщающую способность.

